# Multi Thread Http Server
λ™μ‹μ— μ—¬λ¬ μ”μ²­μ„ μ²λ¦¬ν•λ ¤λ©΄ Multi Threadλ¥Ό κµ¬ν„ν•λ‹¤.

## π“` HttpRequestHandler.class`
π‘‰π» ν΄λΌμ΄μ–ΈνΈμ HTTP μ”μ²­μ„ μ²λ¦¬ν•κ³ , κ°„λ‹¨ν• HTML μ‘λ‹µμ„ λ°ν™ν•λ” HTTP μ„λ²„μ΄λ‹¤.
1. ν΄λΌμ΄μ–ΈνΈμ™€ μ—°κ²°: ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ ‘μ†ν•λ©΄, Socketμ„ ν†µν•΄ μ—°κ²°μ„ μλ½
2. HTTP μ”μ²­ μμ‹ : ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° HTTP μ”μ²­μ„ μ½μ–΄ requestBuilderμ— μ €μ¥
3. HTTP μ‘λ‹µ μƒμ„±: HTTP μ‘λ‹µ ν—¤λ”μ™€ μ‘λ‹µ λ°”λ””(HTML)λ¥Ό μƒμ„±
   - κ°„λ‹¨ν• HTML νμ΄μ§€(`<h1>hello java</h1>`) λ°ν™
4. μ‘λ‹µ μ „μ†΅: BufferedWriterλ¥Ό μ‚¬μ©ν•μ—¬ ν—¤λ”μ™€ λ°”λ””λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅
   - flush()λ¥Ό νΈμ¶ν•μ—¬ μ‘λ‹µμ„ μ¦‰μ‹ μ „μ†΅
5. μ†μΌ“ μΆ…λ£

μ‘λ‹µ ν›„ ν΄λΌμ΄μ–ΈνΈμ™€μ μ—°κ²°μ„ λ‹«μ.

## π“ `SimpleHttpServer.class`
π‘‰π» ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­ν•  λ•λ§λ‹¤ μƒλ΅μ΄ μ¤λ λ“λ¥Ό μƒμ„±ν•μ—¬ μ²λ¦¬ν•λ” λ©€ν‹°μ¤λ λ“ HTTP μ„λ²„μ΄λ‹¤.
1. μ„λ²„ μ†μΌ“(ServerSocket) μƒμ„±
- κΈ°λ³Έ ν¬νΈ(8080) λλ” μ‚¬μ©μκ°€ μ§€μ •ν• ν¬νΈλ΅ μ„λ²„ μ‹¤ν–‰
- ν¬νΈ λ²νΈκ°€ 0 μ΄ν•μΌ κ²½μ° IllegalArgumentException λ°μƒ
- ServerSocketμ„ μƒμ„±ν•μ—¬ ν΄λΌμ΄μ–ΈνΈ μ—°κ²°μ„ κΈ°λ‹¤λ¦Ό

2. ν΄λΌμ΄μ–ΈνΈ μ—°κ²° λ€κΈ° λ° μ²λ¦¬
- λ¬΄ν• λ£¨ν”„(whileλ¬Έ)μ—μ„ ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ λ€κΈ° (accept())
- μ—°κ²°μ΄ λ°μƒν•λ©΄ HttpRequestHandler ν΄λμ¤λ¥Ό μƒλ΅μ΄ Threadλ΅ μ‹¤ν–‰ν•μ—¬ μ”μ²­μ„ μ²λ¦¬
- μ„λ²„κ°€ interrupt μ‹ νΈλ¥Ό λ°›μΌλ©΄ μΆ…λ£λ¨
  <img src="./config/img3.png" alt="image3"></img><br/>
  <img src="./config/img4.png" alt="image4"></img><br/>

---
## π¨ step1κ³Ό step2μ μ°¨μ΄μ 
| λΉ„κµ ν•­λ© | step1(μ‹±κΈ€μ¤λ λ“)                      | step2(λ©€ν‹°μ¤λ λ“)         |
|---------|-----------------------------------|----------------------|
|μ”μ²­ μ²λ¦¬ λ°©μ‹| μ‹±κΈ€μ¤λ λ“(ν• λ²μ— ν•λ‚μ”© μ²λ¦¬)                | λ©€ν‹°μ¤λ λ“(μ—¬λ¬ μ”μ²­ λ™μ‹ μ²λ¦¬)   |
|λ™μ‹μ„±| β λ™μ‹ μ”μ²­ μ²λ¦¬ λ¶κ°€                     | β… μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈ λ™μ‹μ— μ²λ¦¬ κ°€λ¥ |
|κµ¬μ΅° κ°μ„ | μ”μ²­ μ²λ¦¬ μ½”λ“κ°€ `SimpleHttpServer` λ‚΄λ¶€μ— μμ | `HttpRequestHandlerλ΅` λ¶„λ¦¬ν•μ—¬ κ°€λ…μ„± ν–¥μƒ |
|μ„λ²„ μΆ…λ£ μ΅°κ±΄ | β κ°•μ  μΆ…λ£ ν•„μ” | β… Thread μΈν„°λ½νΈλ΅ μ•μ „ν•κ² μΆ…λ£ κ°€λ¥|
|μ‘λ‹µ μ†λ„| μ”μ²­μ΄ λ§μ•„μ§€λ©΄ μ§€μ—° λ°μƒ | μ”μ²­μ΄ λ§μ•„λ„ λΉ λ¥Έ μ‘λ‹µ κ°€λ¥|
|ν™•μ¥μ„±| β μ„±λ¥ ν™•μ¥μ΄ μ–΄λ ¤μ›€ | β…μ—¬λ¬ μ”μ²­μ„ λ™μ‹μ— μ²λ¦¬ν•μ—¬ ν™•μ¥μ„± λ†’μ |


π‘‰π»**Step2λ” Step1λ³΄λ‹¤ λ” ν¨μ¨μ μ΄κ³  ν™•μ¥μ„±μ΄ λ›°μ–΄λ‚¨**
Step2λ” Step1λ³΄λ‹¤ λ” λ§μ€ μ”μ²­μ„ ν¨μ¨μ μΌλ΅ μ²λ¦¬ν•  μ μλ” κµ¬μ΅°λ΅ κ°μ„ λμ—μΌλ©°,
μ‹¤μ  μ›Ή μ„λ²„μ™€ μ μ‚¬ν• λ°©μ‹μΌλ΅ λ™μ‘ν•  μ μλ„λ΅ μ—…κ·Έλ μ΄λ“λ λ²„μ „μ΄λΌκ³  λ³΄λ©΄ λλ‹¤.
- Step2λ” λ©€ν‹°μ¤λ λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ—¬λ¬ μ”μ²­μ„ λ™μ‹μ— μ²λ¦¬ν•  μ μμ–΄ μ„λ²„ μ„±λ¥μ΄ ν–¥μƒ
- Step1μ€ μ‹±κΈ€μ¤λ λ“ λ°©μ‹μ΄λ―€λ΅, ν•λ‚μ μ”μ²­μ΄ λλ‚μ•Ό λ‹¤μ μ”μ²­μ„ μ²λ¦¬ν•  μ μμ
- Step2λ” HttpRequestHandler ν΄λμ¤λ¥Ό λ¶„λ¦¬ν•μ—¬ μ μ§€λ³΄μκ°€ μ©μ΄
- Step2λ” Thread μΈν„°λ½νΈλ¥Ό μ¶”κ°€ν•μ—¬ μ •μƒμ μΈ μ„λ²„ μΆ…λ£κ°€ κ°€λ¥

---
## π¤” Server Socketμ„ μ„ μ–Έν•  λ• try-catch κµ¬λ¬Έμ„ ν•­μƒ μ‚¬μ©ν•λ” μ΄μ 
``` java
public SimpleHttpServer(int port) {
    if (port < 0) {
        throw new IllegalArgumentException("port must be a positive integer");
    }

    this.port = port;
    try {
		serverSocket = new ServerSocket(this.port);
	} catch (IOException e) {
	    throw new RuntimeException(e);
	}
}
``` 
ServerSocketμ„ μƒμ„±ν•  λ• ν•­μƒ try-catch λ¥Ό μ‚¬μ©ν•λ” μ΄μ λ” **μ…μ¶λ ¥ μμ™Έ(IOException)κ°€ λ°μƒν•  κ°€λ¥μ„±**μ΄ μκΈ° λ•λ¬Έμ΄λ‹¤.
- ν¬νΈ μ¶©λ: ν•΄λ‹Ή ν¬νΈκ°€ μ΄λ―Έ λ‹¤λ¥Έ ν”„λ΅κ·Έλ¨μ—μ„ μ‚¬μ© μ¤‘μ΄λ©΄ IOException λ°μƒ
- κ¶ν• λ¬Έμ : νΉμ • ν¬νΈ(μ: 1024 μ΄ν•)λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ κ΄€λ¦¬μ κ¶ν•μ΄ ν•„μ”ν•  μ μμ
- λ„¤νΈμ›ν¬ λ¬Έμ : μ„λ²„κ°€ νΉμ • λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•  μ μ—†λ” κ²½μ° μμ™Έ λ°μƒ
- κΈ°νƒ€ μ‹μ¤ν… μ¤λ¥: μ†μΌ“ λ¦¬μ†μ¤ λ¶€μ΅±, OS μ ν• λ“±μΌλ΅ μΈν•΄ μμ™Έ λ°μƒ κ°€λ¥

### β”οΈ CRLF = "\r\n"
``` java
private final static String CRLF="\r\n"; 
``` 
HTTP ν”„λ΅ν† μ½μ—μ„ μ¤„λ°”κΏμ„ μλ―Έ 

### β”οΈ μ…μ¶λ ¥ μ¤νΈλ¦Ό μ΄κΈ°ν™”
``` java
public void run() {
    StringBuilder requestBuilder = new StringBuilder();
    try (
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(client.getInputStream()));
        BufferedWriter bufferedWriter = new BufferedWriter(new OutputStreamWriter(client.getOutputStream()));
    ) {
``` 
- `BufferedReader` β†’ ν΄λΌμ΄μ–ΈνΈ μ”μ²­(HTTP Request)μ„ μ½μ.
- `BufferedWriter` β†’ μ„λ²„ μ‘λ‹µ(HTTP Response)μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λƒ„.
